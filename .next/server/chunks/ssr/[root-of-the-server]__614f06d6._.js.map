{"version":3,"sources":["turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/module.compiled.js","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","turbopack:///[project]/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","turbopack:///[project]/src/app/chat/page.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","\"use client\";\r\n\r\nimport { useEffect, useMemo, useRef, useState } from \"react\";\r\n\r\nasync function fetchJSON(url, options) {\r\n  const res = await fetch(url, options);\r\n  if (!res.ok) {\r\n    let message = \"Request failed\";\r\n    try {\r\n      const data = await res.json();\r\n      if (data && typeof data.error === \"string\") message = data.error;\r\n    } catch {\r\n      try {\r\n        const text = await res.text();\r\n        if (text) message = text;\r\n      } catch {}\r\n    }\r\n    throw new Error(message);\r\n  }\r\n  try {\r\n    return await res.json();\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\nexport default function ChatPage() {\r\n  const [isMounted, setIsMounted] = useState(false);\r\n  const [sessions, setSessions] = useState([]);\r\n  const [activeSession, setActiveSession] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [streamingText, setStreamingText] = useState(\"\");\r\n  const bottomRef = useRef(null);\r\n\r\n  const canSend = useMemo(() => input.trim().length > 0 && !!activeSession, [\r\n    input,\r\n    activeSession,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    // Ensure locale-sensitive rendering only happens on the client after mount\r\n    setIsMounted(true);\r\n    // Auto-create a fresh session and do not load previous sessions\r\n    (async () => {\r\n      try {\r\n        const { session } = await fetchJSON(\"/api/sessions\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ title: \"Career Counseling Chat\" }),\r\n        });\r\n        setActiveSession(session);\r\n        setSessions([session]);\r\n        setMessages([]);\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  // Do not fetch old messages when switching sessions; always start empty\r\n  useEffect(() => {\r\n    if (!activeSession) return;\r\n    setMessages([]);\r\n  }, [activeSession]);\r\n\r\n  useEffect(() => {\r\n    bottomRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  async function onNewSession() {\r\n    const title = \"Career Counseling Chat\";\r\n    const { session } = await fetchJSON(\"/api/sessions\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ title }),\r\n    });\r\n    setSessions((s) => [session, ...s]);\r\n    setActiveSession(session);\r\n    setMessages([]);\r\n  }\r\n\r\n  async function onSend() {\r\n    if (!canSend) return;\r\n    setLoading(true);\r\n    try {\r\n      const streamRes = await fetch(\"/api/messages/stream\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          sessionId: activeSession.id,\r\n          content: input,\r\n        }),\r\n      });\r\n      if (!streamRes.ok || !streamRes.body) {\r\n        let errMsg = \"Streaming response failed\";\r\n        try {\r\n          const text = await streamRes.text();\r\n          if (text) errMsg = text;\r\n        } catch {}\r\n        throw new Error(errMsg);\r\n      }\r\n\r\n      const optimisticUser = {\r\n        id: `local-${Date.now()}`,\r\n        session_id: activeSession.id,\r\n        role: \"user\",\r\n        content: input,\r\n        created_at: new Date().toISOString(),\r\n      };\r\n      setMessages((m) => [...m, optimisticUser]);\r\n      setInput(\"\");\r\n\r\n      const reader = streamRes.body.getReader();\r\n      const decoder = new TextDecoder(\"utf-8\");\r\n      setStreamingText(\"\");\r\n      for (;;) {\r\n        const { done, value } = await reader.read();\r\n        if (done) break;\r\n        const chunk = decoder.decode(value, { stream: true });\r\n        setStreamingText((t) => t + chunk);\r\n      }\r\n\r\n      // Do not refetch from server; keep current view minimal\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-dvh flex bg-[var(--background)] text-[var(--foreground)]\">\r\n      {/* Hide sessions UI */}\r\n      <aside className=\"hidden\" style={{ borderColor: \"var(--border)\", background: \"var(--card)\" }}>\r\n      </aside>\r\n      <main className=\"flex-1 flex flex-col min-h-dvh\">\r\n        <header className=\"p-4 border-b flex items-center justify-between gap-4\" style={{ borderColor: \"var(--border)\", background: \"var(--card)\" }}>\r\n          <div className=\"font-semibold\">\r\n            {activeSession ? activeSession.title : \"Preparing session...\"}\r\n          </div>\r\n          <div className=\"flex items-center gap-2 min-w-0\">\r\n            <button\r\n              onClick={onNewSession}\r\n              className=\"text-sm border rounded px-2 py-1 hover:bg-[var(--muted)]\"\r\n            >\r\n              New\r\n            </button>\r\n          </div>\r\n        </header>\r\n        <section className=\"flex-1 overflow-y-auto p-4 space-y-3 pb-24\" style={{ background: \"var(--background)\" }}>\r\n          {!activeSession && (\r\n            <div className=\"text-neutral-500\">Preparing a new sessionâ€¦</div>\r\n          )}\r\n          {messages.map((m) => (\r\n            <div key={m.id} className=\"max-w-[80ch]\">\r\n              <div className=\"text-xs text-neutral-500 mb-1\">\r\n                {m.role === \"user\" ? \"You\" : \"Assistant\"}\r\n              </div>\r\n              <div\r\n                className={`whitespace-pre-wrap rounded p-3 ${\r\n                  m.role === \"user\"\r\n                    ? \"bg-blue-50 border border-blue-100\"\r\n                    : \"bg-[var(--muted)] border\"\r\n                }`}\r\n                style={{ borderColor: m.role === \"user\" ? \"#bfdbfe\" : \"var(--border)\" }}\r\n              >\r\n                {m.content}\r\n              </div>\r\n            </div>\r\n          ))}\r\n          {streamingText && (\r\n            <div className=\"max-w-[80ch]\">\r\n              <div className=\"text-xs text-neutral-500 mb-1\">Assistant</div>\r\n              <div className=\"whitespace-pre-wrap rounded p-3 bg-[var(--muted)] border\" style={{ borderColor: \"var(--border)\" }}>\r\n                {streamingText}\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div ref={bottomRef} />\r\n        </section>\r\n        <footer className=\"p-4 border-t fixed bottom-0 left-0 right-0 z-10\" style={{ borderColor: \"var(--border)\", background: \"var(--card)\" }}>\r\n          <div className=\"mx-auto w-full max-w-screen-xl\">\r\n            <div className=\"flex gap-2 w-full items-end px-4 md:px-0\">\r\n              <input\r\n                value={input}\r\n                onChange={(e) => setInput(e.target.value)}\r\n                placeholder={activeSession ? \"Type your message...\" : \"Preparing session...\"}\r\n                className=\"flex-1 min-w-0 border rounded px-3 py-2\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === \"Enter\" && !e.shiftKey) {\r\n                    e.preventDefault();\r\n                    onSend();\r\n                  }\r\n                }}\r\n              />\r\n              <button\r\n                disabled={!canSend || loading}\r\n                onClick={onSend}\r\n                className=\"border rounded px-4 py-2 disabled:opacity-50\"\r\n                style={{ background: \"var(--accent)\", color: \"var(--accent-foreground)\", borderColor: \"var(--accent)\" }}\r\n              >\r\n                {loading ? \"Sending...\" : \"Send\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </footer>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}