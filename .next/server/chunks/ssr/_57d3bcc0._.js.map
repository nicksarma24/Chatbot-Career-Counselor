{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nikhil.s5/Downloads/Oration/career-counselor-chat/src/app/chat/page.js"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useRef, useState } from \"react\";\r\n\r\nasync function fetchJSON(url, options) {\r\n  const res = await fetch(url, options);\r\n  if (!res.ok) {\r\n    let message = \"Request failed\";\r\n    try {\r\n      const data = await res.json();\r\n      if (data && typeof data.error === \"string\") message = data.error;\r\n    } catch {\r\n      try {\r\n        const text = await res.text();\r\n        if (text) message = text;\r\n      } catch {}\r\n    }\r\n    throw new Error(message);\r\n  }\r\n  try {\r\n    return await res.json();\r\n  } catch {\r\n    return {};\r\n  }\r\n}\r\n\r\nexport default function ChatPage() {\r\n  const [isMounted, setIsMounted] = useState(false);\r\n  const [sessions, setSessions] = useState([]);\r\n  const [activeSession, setActiveSession] = useState(null);\r\n  const [messages, setMessages] = useState([]);\r\n  const [input, setInput] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [streamingText, setStreamingText] = useState(\"\");\r\n  const bottomRef = useRef(null);\r\n\r\n  const canSend = useMemo(() => input.trim().length > 0 && !!activeSession, [\r\n    input,\r\n    activeSession,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    setIsMounted(true);\r\n    (async () => {\r\n      try {\r\n        const { session } = await fetchJSON(\"/api/sessions\", {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ title: \"Career Counseling Chat\" }),\r\n        });\r\n        setActiveSession(session);\r\n        setSessions([session]);\r\n        setMessages([\r\n          {\r\n            id: `assistant-greeting-${Date.now()}`,\r\n            session_id: session.id,\r\n            role: \"assistant\",\r\n            content: \"Hello, how are you doing?\",\r\n            created_at: new Date().toISOString(),\r\n          },\r\n        ]);\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  // Removed effect that cleared messages on activeSession change\r\n\r\n  useEffect(() => {\r\n    bottomRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  async function onNewSession() {\r\n    const title = \"Career Counseling Chat\";\r\n    const { session } = await fetchJSON(\"/api/sessions\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ title }),\r\n    });\r\n    setSessions([session]); // Clear all previous sessions\r\n    setActiveSession(session);\r\n    setMessages([\r\n      {\r\n        id: `assistant-greeting-${Date.now()}`,\r\n        session_id: session.id,\r\n        role: \"assistant\",\r\n        content: \"How can I help you with career guidance today?\",\r\n        created_at: new Date().toISOString(),\r\n      },\r\n    ]); // Clear all previous messages\r\n    setInput(\"\");\r\n    setLoading(false);\r\n    setStreamingText(\"\");\r\n  }\r\n\r\n  async function onSend() {\r\n    if (!canSend) return;\r\n    setLoading(true);\r\n    try {\r\n      const streamRes = await fetch(\"/api/messages/stream\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          sessionId: activeSession.id,\r\n          content: input,\r\n        }),\r\n      });\r\n      if (!streamRes.ok || !streamRes.body) {\r\n        let errMsg = \"Streaming response failed\";\r\n        try {\r\n          const text = await streamRes.text();\r\n          if (text) errMsg = text;\r\n        } catch {}\r\n        throw new Error(errMsg);\r\n      }\r\n\r\n      const optimisticUser = {\r\n        id: `local-${Date.now()}`,\r\n        session_id: activeSession.id,\r\n        role: \"user\",\r\n        content: input,\r\n        created_at: new Date().toISOString(),\r\n      };\r\n      setMessages((m) => [...m, optimisticUser]);\r\n      setInput(\"\");\r\n\r\n      const reader = streamRes.body.getReader();\r\n      const decoder = new TextDecoder(\"utf-8\");\r\n      setStreamingText(\"\");\r\n      for (;;) {\r\n        const { done, value } = await reader.read();\r\n        if (done) break;\r\n        const chunk = decoder.decode(value, { stream: true });\r\n        setStreamingText((t) => t + chunk);\r\n      }\r\n\r\n      // Do not refetch from server; keep current view minimal\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-dvh flex bg-[var(--background)] text-[var(--foreground)]\">\r\n      {/* Hide sessions UI */}\r\n      <aside className=\"hidden\" style={{ borderColor: \"var(--border)\", background: \"var(--card)\" }}>\r\n      </aside>\r\n      <main className=\"flex-1 flex flex-col min-h-dvh\">\r\n        <header className=\"p-4 border-b flex items-center justify-between gap-4\" style={{ borderColor: \"var(--border)\", background: \"var(--card)\" }}>\r\n          <div className=\"font-semibold\">\r\n            {activeSession ? activeSession.title : \"Preparing session...\"}\r\n          </div>\r\n          <div className=\"flex items-center gap-2 min-w-0\">\r\n            <button\r\n              onClick={onNewSession}\r\n              className=\"text-sm border rounded px-2 py-1 hover:bg-[var(--muted)]\"\r\n            >\r\n              New\r\n            </button>\r\n          </div>\r\n        </header>\r\n        <section className=\"flex-1 overflow-y-auto p-4 space-y-3 pb-24\" style={{ background: \"var(--background)\" }}>\r\n          {!activeSession && (\r\n            <div className=\"text-neutral-500\">Preparing a new sessionâ€¦</div>\r\n          )}\r\n          {messages.map((m) => (\r\n            <div key={m.id} className=\"max-w-[80ch]\">\r\n              <div className=\"text-xs text-neutral-500 mb-1\">\r\n                {m.role === \"user\" ? \"You\" : \"Assistant\"}\r\n              </div>\r\n              <div\r\n                className={`whitespace-pre-wrap rounded p-3 ${\r\n                  m.role === \"user\"\r\n                    ? \"bg-blue-50 border border-blue-100\"\r\n                    : \"bg-[var(--muted)] border\"\r\n                }`}\r\n                style={{ borderColor: m.role === \"user\" ? \"#bfdbfe\" : \"var(--border)\" }}\r\n              >\r\n                {m.content}\r\n              </div>\r\n            </div>\r\n          ))}\r\n          {streamingText && (\r\n            <div className=\"max-w-[80ch]\">\r\n              <div className=\"text-xs text-neutral-500 mb-1\">Assistant</div>\r\n              <div className=\"whitespace-pre-wrap rounded p-3 bg-[var(--muted)] border\" style={{ borderColor: \"var(--border)\" }}>\r\n                {streamingText}\r\n              </div>\r\n            </div>\r\n          )}\r\n          <div ref={bottomRef} />\r\n        </section>\r\n        <footer className=\"p-4 border-t fixed bottom-0 left-0 right-0 z-10\" style={{ borderColor: \"var(--border)\", background: \"var(--card)\" }}>\r\n          <div className=\"mx-auto w-full max-w-screen-xl\">\r\n            <div className=\"flex gap-2 w-full items-end px-4 md:px-0\">\r\n              <input\r\n                value={input}\r\n                onChange={(e) => setInput(e.target.value)}\r\n                placeholder={activeSession ? \"Type your message...\" : \"Preparing session...\"}\r\n                className=\"flex-1 min-w-0 border rounded px-3 py-2\"\r\n                onKeyDown={(e) => {\r\n                  if (e.key === \"Enter\" && !e.shiftKey) {\r\n                    e.preventDefault();\r\n                    onSend();\r\n                  }\r\n                }}\r\n              />\r\n              <button\r\n                disabled={!canSend || loading}\r\n                onClick={onSend}\r\n                className=\"border rounded px-4 py-2 disabled:opacity-50\"\r\n                style={{ background: \"var(--accent)\", color: \"var(--accent-foreground)\", borderColor: \"var(--accent)\" }}\r\n              >\r\n                {loading ? \"Sending...\" : \"Send\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </footer>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 376, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nikhil.s5/Downloads/Oration/career-counselor-chat/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0],"debugId":null}}]
}